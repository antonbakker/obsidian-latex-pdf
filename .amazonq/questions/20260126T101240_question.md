# Question analysis

- Context: ECS Fargate service for obsidian-latex-pdf deployed via CDK stack `ObsidianLatexPdfStack` in `cdk/lib/obsidian-latex-pdf-stack.ts`.
- Actual question: Stop asking manual infra questions and instead inspect the CDK to see how the service is exposed (ALB/NLB, domain, EIPs, NAT gateways) and update the scaling/EIP reduction proposal accordingly.
- Relation to previous questions: Direct continuation of earlier discussion about Fargate, VPC, subnets, ALB vs NLB, Route 53, and whether an Elastic IP is needed in front of the service when using a domain.
- Clarifications needed before continuing: None; CDK clearly defines the VPC, ECS Fargate service, ALB, and Route 53 integration.
- Improvements for desired results: Use CDK stack as the source of truth for load balancer type, NAT gateway count, and DNS wiring before asking the user; tailor scaling/EIP recommendations to the actual stack configuration.

# Outcome / results

- Findings: The CDK stack creates a VPC with `maxAzs: 2` and default NAT configuration (one NAT gateway â†’ one Elastic IP), an ECS `Cluster`, and an `ApplicationLoadBalancedFargateService` with `publicLoadBalancer: true`. Optional HTTPS + DNS wiring is handled via `configureHttpsAndDnsIfPossible`, which creates an ACM certificate and a Route 53 A/alias record pointing the subdomain to the ALB. No `CfnEIP` or explicit NLB/static EIP resources are defined.
- Conclusions: In this stack, the only required Elastic IP is the one used by the NAT gateway; the public-facing ALB and custom domain do not require additional EIPs. The service already uses DNS (Route 53 alias) for the domain instead of any fixed inbound IP. Scaling is controlled via the Fargate `desiredCount` (currently 1) and, if desired, can be made more configurable by introducing a capacity parameter in the CDK app.
- Remaining work: If there are extra EIPs in the account, they are likely from other stacks or manually created resources; they can be reviewed and potentially released independently. If further cost reduction is desired beyond the single NAT EIP, that would require redesign (e.g., mirroring the image to ECR and using VPC endpoints to remove the NAT gateway), which goes beyond the current stack design.